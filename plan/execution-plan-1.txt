End-to-End Development Plan

LangGraph Agent with Weather Tool + PDF RAG + LangSmith + Streamlit

Goal

Build a deployable Streamlit chat application backed by a LangGraph agent that can:

Answer weather-related queries using the OpenWeatherMap API

Answer document-based queries using RAG over a PDF stored in Qdrant Cloud

Use LangSmith to trace and evaluate LLM behavior

Include unit tests, clean modular code, and clear documentation

This implementation should demonstrate:

Agentic routing & decision-making

RAG fundamentals (embeddings, vector DB, retrieval)

Production-oriented Python code practices

Observability and evaluation using LangSmith

Phase 0 — Lock Decisions Upfront (15–20 minutes)

These decisions are fixed before coding to avoid refactors later.

LLM provider: OpenAI (or Anthropic – pick one and stay consistent)

Embedding model: One fixed embedding model (must match Qdrant vector size)

Vector DB: Qdrant Cloud

Routing strategy: Intent-based

Weather queries → OpenWeather API

All other queries → PDF RAG

PDF: Generic, non-weather informational PDF

LangSmith usage:

Trace all LLM calls

Evaluate both Weather + RAG final answers

RAG evaluation: groundedness / relevance

Weather evaluation: lightweight format/completeness (e.g., includes location, temp, conditions)

Testing:

External APIs mocked

No real HTTP or LLM calls in unit tests

Output of this phase

Confirmed model choices

Selected PDF

.env.example variable list

Phase 1 — Project Skeleton & Environment (30–45 minutes)
Repository Structure
app/
  main.py
  graph/
    build_graph.py
    state.py
    nodes/
      route.py
      weather.py
      rag.py
      answer.py
  services/
    weather_client.py
    llm.py
  rag/
    ingest.py
    retriever.py
  ui/
    streamlit_app.py
tests/
  test_route.py
  test_weather.py
  test_rag.py
  test_answer.py
scripts/
  ingest_pdf.py
.env.example
README.md

Environment Setup

Add .env.example with:

OPENAI_API_KEY

LANGSMITH_API_KEY

LANGSMITH_PROJECT

OPENWEATHER_API_KEY

QDRANT_URL

QDRANT_API_KEY

Output of this phase

Clean, reproducible repo foundation

Environment variables documented

README scaffold started

Phase 2 — Graph State & Contracts (30 minutes)

Define a single shared state object for LangGraph.

Example fields:

query: str

route: Literal["weather", "pdf"]

tool_result: dict | None

retrieved_docs: list

final_answer: str

route_reason: str

This enforces:

Predictable data flow

Testability

Easy debugging

Output of this phase

Strongly defined graph contract

No ad-hoc state mutations later

Phase 3 — PDF Ingestion into Qdrant (Offline Step) (1–2 hours)
One-time ingestion script

scripts/ingest_pdf.py

Steps:

Load PDF

Split into chunks (size + overlap)

Generate embeddings

Upsert into single Qdrant collection

Store metadata per chunk:

source file

page number

chunk id

optional section heading

Design notes:

Deterministic chunk IDs

Safe to re-run ingestion without duplication

Important clarification:

We embed and store vectors for the processed PDF chunks (the corpus) in Qdrant.

User queries are embedded on-the-fly at runtime for retrieval and are not stored in Qdrant.

Output of this phase

Qdrant Cloud populated with document vectors

Verified retrieval via manual query

Phase 4 — RAG Query Mechanism (1–2 hours)
Retrieval

rag/retriever.py

Embed user query

Qdrant similarity search (top-k)

Return chunks + metadata

RAG Node

graph/nodes/rag.py

Calls retriever

Stores retrieved docs in graph state

Answer Generation

Handled later in the answer node using retrieved context only.

Output of this phase

Reliable document retrieval

Clean separation of retrieval vs generation

Phase 5 — Weather Tool Implementation (45–90 minutes)
Weather Client

services/weather_client.py

Responsibilities:

Parse location from query

Call OpenWeatherMap API

Normalize response into structured JSON

Handle errors gracefully

Weather Node

graph/nodes/weather.py

Calls weather client

Stores structured weather data in graph state

Output of this phase

Stable weather tool

Fully testable without graph context

Phase 6 — LangGraph Agentic Pipeline (1–2 hours)
Router Node

graph/nodes/route.py

Determines intent:

weather vs non-weather

Sets:

route

route_reason (explainability)

Answer Node

graph/nodes/answer.py

Single LLM boundary

Behavior:

Weather route → summarize structured weather data

PDF route → answer strictly from retrieved docs

Graph Wiring

graph/build_graph.py

Flow:

START
  ↓
Route Node
  ↓ (conditional)
Weather Node OR RAG Node
  ↓
Answer Node
  ↓
END


Output of this phase

Fully functional agentic pipeline

Explainable routing decisions

Phase 7 — Streamlit UI (1–2 hours)
UI Features

Chat input box

Display assistant response

Display chosen route (Weather / PDF)

Optional expandable section:

Retrieved document chunks (RAG only)

Keep UI simple and functional.

Output of this phase

End-to-end interactive demo

Easy for evaluators to test

Phase 8 — LangSmith Tracing & Evaluation (1–2 hours)
Tracing

Enable LangSmith for:

All LLM calls

Tool usage

Retrieval inputs/outputs

Evaluation

Apply evaluators to both Weather + RAG final answers

Example criteria:

Groundedness (answer uses retrieved context)

Relevance

; x Weather response completeness/format (e.g., includes key fields from tool result)

Capture Evidence

Screenshots of traces

Screenshots of evaluation results

Output of this phase

LangSmith artifacts ready for submission

Clear evaluation narrative

Phase 9 — Tests (2–4 hours)
Unit Tests (pytest)

API handling

Mock OpenWeather API

Success + error cases

Routing

Weather intent → weather route

Non-weather intent → RAG route

Retrieval

Mock Qdrant client

Validate top-k behavior + metadata formatting

LLM processing

Mock LLM calls

Assert prompt construction and output handling

Output of this phase

Repeatable, deterministic test results

Test logs/screenshots for submission

Phase 10 — Packaging & Submission (1–2 hours)
README

Include:

Architecture overview

Routing logic explanation

RAG design

LangSmith evaluation approach

How to run:

ingestion

app

tests

Loom Video

Show:

Routing behavior

Weather query demo

PDF RAG demo

LangSmith traces + evaluation

Code walkthrough (graph + nodes)

Final Output

GitHub repo

Streamlit demo

LangSmith screenshots

Tests

Loom video

Acceptance Criteria Mapping (Nothing Missed)

LangGraph agentic pipeline → ✅

Weather API integration → ✅

PDF RAG with Qdrant → ✅

Decision-making node → ✅

LangSmith evaluation → ✅

Clean code & tests → ✅

Streamlit UI → ✅

All deliverables → ✅


Next Steps of Action (Do This Now)

Goal: get all external dependencies (Qdrant Cloud, OpenAI, LangSmith, OpenWeather) working end-to-end before building the full LangGraph + Streamlit app.

1) Lock model choices (OpenAI via LangChain)
- Chat model: pick one (recommended: gpt-4o-mini for speed/cost, or gpt-4o for quality)
- Embedding model: text-embedding-3-small (vector size 1536) OR text-embedding-3-large (vector size 3072)
- Decide once; Qdrant collection vector size must match the chosen embedding model.

2) Set up secrets (local dev + later deployment)
- OPENAI_API_KEY
- OPENWEATHER_API_KEY
- QDRANT_URL
- QDRANT_API_KEY
- LANGSMITH_API_KEY (use Personal Access Token)
- LANGSMITH_PROJECT (choose a project name, e.g., neura-assignment)
- Enable LangSmith tracing for LangChain (standard env flags as per LangSmith docs)

3) Qdrant Cloud setup
- Create/confirm your Qdrant Cloud cluster
- Create a collection (recommended name: test_rag_assignment_v1)
- Configure:
  - vector size = embedding model dimension (1536 or 3072)
  - distance = cosine

4) Ingest the PDF into Qdrant (one-time offline step)
Input PDF: test-rag-assignment.pdf (17 pages)
- Chunk the PDF (size + overlap)
- For each chunk store metadata:
  - page number
  - chunk_id (deterministic)
  - source file name
- Generate embeddings for each chunk and upsert into the Qdrant collection

5) Sanity-check retrieval before full app build
- Run a few manual queries against Qdrant and confirm:
  - results are relevant
  - returned metadata includes page + chunk_id (needed for citations)

6) Confirm external connectivity scripts pass (quick confidence gate)
- Qdrant connection test
- OpenWeather connection test
- LangSmith connection / tracing test

7) Start implementation phases
- Build RAG retriever module
- Build weather tool module
- Build LangGraph (route → tool → answer)
- Build Streamlit chat UI (show route + citations)
- Add tests + LangSmith eval evidence + Loom walkthrough